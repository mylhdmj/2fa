<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简易2FA验证码生成器</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- OTPAuth Library -->
    <script src="https://cdn.jsdelivr.net/npm/otpauth@9.1.4/dist/otpauth.umd.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CBCB',
                        danger: '#F53F3F',
                        success: '#00B42A',
                        warning: '#FF7D00',
                        dark: '#1D2129',
                        light: '#F2F3F5',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 20px rgba(0, 0, 0, 0.08)',
                        'hover': '0 8px 30px rgba(0, 0, 0, 0.12)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 30s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .bg-gradient-primary {
                background: linear-gradient(135deg, #165DFF 0%, #36CBCB 100%);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.8);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }
            .otp-display {
                letter-spacing: 0.2em;
                font-variant-numeric: tabular-nums;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans text-dark">
    <!-- 主容器 -->
    <div class="min-h-screen flex flex-col items-center justify-center-center p-4">
        <!-- 卡片 -->
        <div class="w-full max-w-md bg-white rounded-2xl shadow-card p-8 transition-all-300 hover:shadow-hover">
            <!-- 标题区域 -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4">
                    <i class="fa fa-shield text-2xl text-primary"></i>
                </div>
                <h1 class="text-2xl font-bold text-dark">简易2FA验证码生成器</h1>
                <p class="text-gray-500 mt-2">输入密钥，获取6位验证码</p>
            </div>
            
            <!-- 输入区域 -->
            <div class="mb-6">
                <label for="secretKey" class="block text-gray-500 mb-2">2FA密钥</label>
                <div class="flex">
                    <input type="text" id="secretKey" placeholder="例如: XCDINALI5EQCQA5S" 
                           class="flex-1 px-4 py-3 border border-gray-300 rounded-l-lg focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all text-sm">
                    <button id="generateBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-r-lg shadow-md transition-all-300 whitespace-nowrap">
                        <i class="fa fa-key mr-2"></i> 生成验证码
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-2">示例密钥: XCDINALI5EQCQA5S</p>
            </div>
            
            <!-- 验证码显示区域 -->
            <div id="otpContainer" class="mb-6 hidden">
                <div class="text-center mb-2">
                    <p class="text-gray-500 text-sm">当前验证码</p>
                    <div id="otpCode" class="text-4xl font-bold text-primary otp-display my-4"></div>
                    
                    <!-- 倒计时进度条 -->
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-1">
                        <div id="countdown" class="bg-primary h-2 rounded-full" style="width: 100%"></div>
                    </div>
                    <p id="countdownText" class="text-xs text-gray-400">30秒后刷新</p>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex space-x-3">
                    <button id="copyBtn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg shadow-sm transition-all-300 flex items-center justify-center">
                        <i class="fa fa-copy mr-2"></i> 复制验证码
                    </button>
                    <button id="refreshBtn" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg shadow-md transition-all-300 flex items-center justify-center">
                        <i class="fa fa-refresh mr-2"></i> 刷新
                    </button>
                </div>
            </div>
            
            <!-- 历史记录区域 -->
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fa fa-history text-gray-500 mr-2"></i> 历史记录
                </h3>
                <div id="historyContainer" class="max-h-40 overflow-y-auto">
                    <div id="noHistory" class="text-center text-gray-400 py-4 text-sm">
                        暂无历史记录
                    </div>
                    <ul id="historyList" class="divide-y divide-gray-100 hidden"></ul>
                </div>
            </div>
        </div>
        
        <!-- 页脚 -->
        <footer class="mt-8 text-center text-gray-400 text-sm">
            <p>© 2025 简易2FA验证码生成器 | 验证码有效期为30秒 | 没有灵魂的卖家</p>
        </footer>
    </div>
    
    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-sm transform translate-y-full opacity-0 transition-all duration-300 z-50">
        <div class="flex items-start">
            <div id="notificationIcon" class="flex-shrink-0 w-6 h-6 mr-3 flex items-center justify-center rounded-full">
                <i id="notificationIconI" class="fa"></i>
            </div>
            <div class="flex-1">
                <h4 id="notificationTitle" class="text-sm font-medium"></h4>
                <p id="notificationMessage" class="text-sm text-gray-500 mt-1"></p>
            </div>
            <button id="closeNotification" class="text-gray-400 hover:text-gray-500 ml-4">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // 全局变量
        let currentTotp = null;
        let countdownInterval = null;
        let history = JSON.parse(localStorage.getItem('2faHistory')) || [];
        
        // DOM 元素
        const secretKeyInput = document.getElementById('secretKey');
        const generateBtn = document.getElementById('generateBtn');
        const otpContainer = document.getElementById('otpContainer');
        const otpCode = document.getElementById('otpCode');
        const countdown = document.getElementById('countdown');
        const countdownText = document.getElementById('countdownText');
        const copyBtn = document.getElementById('copyBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationIcon = document.getElementById('notificationIcon');
        const notificationIconI = document.getElementById('notificationIconI');
        const closeNotification = document.getElementById('closeNotification');
        const noHistory = document.getElementById('noHistory');
        const historyList = document.getElementById('historyList');
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 设置通知关闭按钮
            closeNotification.addEventListener('click', hideNotification);
            
            // 渲染历史记录
            renderHistory();
            
            // 如果有历史记录，自动填充最后一个密钥
            if (history.length > 0) {
                secretKeyInput.value = history[0].secret;
            }
        });
        
        // 生成验证码按钮点击事件
        generateBtn.addEventListener('click', generateOTP);
        
        // 刷新按钮点击事件
        refreshBtn.addEventListener('click', generateOTP);
        
        // 复制按钮点击事件
        copyBtn.addEventListener('click', () => {
            const textToCopy = otpCode.textContent;
            
            // 创建临时输入框
            const tempInput = document.createElement('input');
            tempInput.value = textToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            // 显示复制成功动画
            copyBtn.innerHTML = '<i class="fa fa-check mr-2"></i> 已复制';
            copyBtn.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
            copyBtn.classList.add('bg-success', 'hover:bg-success/90', 'text-white');
            
            setTimeout(() => {
                copyBtn.innerHTML = '<i class="fa fa-copy mr-2"></i> 复制验证码';
                copyBtn.classList.remove('bg-success', 'hover:bg-success/90', 'text-white');
                copyBtn.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
            }, 2000);
            
            showNotification('success', '复制成功', '验证码已复制到剪贴板');
        });
        
        // 生成OTP
        function generateOTP() {
            const secret = secretKeyInput.value.trim().replace(/\s+/g, '');
            
            // 验证输入
            if (!secret) {
                showNotification('error', '生成失败', '请输入2FA密钥');
                return;
            }
            
            try {
                // 创建TOTP对象
                currentTotp = new OTPAuth.TOTP({
                    algorithm: 'SHA1',
                    digits: 6,
                    period: 30,
                    secret: OTPAuth.Secret.fromBase32(secret)
                });
                
                // 生成当前OTP
                const token = currentTotp.generate();
                otpCode.textContent = token;
                
                // 显示OTP容器
                otpContainer.classList.remove('hidden');
                
                // 启动倒计时
                startCountdown();
                
                // 添加到历史记录
                addToHistory(secret);
                
                // 显示成功通知
                showNotification('success', '生成成功', '验证码已生成，有效期30秒');
            } catch (error) {
                console.error('生成OTP错误:', error);
                showNotification('error', '生成失败', '无效的密钥格式，请检查输入');
            }
        }
        
        // 启动倒计时
        function startCountdown() {
            // 清除之前的倒计时
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            const period = 30; // 固定30秒有效期
            
            // 立即更新一次验证码
            updateOTP();
            
            // 获取当前时间窗口
            let currentWindow = Math.floor(Date.now() / (period * 1000));
            
            countdownInterval = setInterval(() => {
                const now = Date.now();
                const seconds = Math.floor(now / 1000);
                const remaining = period - (seconds % period);
                const newWindow = Math.floor(now / (period * 1000));
                
                // 更新进度条
                const percentage = (remaining / period) * 100;
                countdown.style.width = `${percentage}%`;
                
                // 更新文本
                countdownText.textContent = `${remaining}秒后刷新`;
                
                // 如果时间窗口改变，更新OTP
                if (newWindow !== currentWindow) {
                    currentWindow = newWindow;
                    updateOTP();
                }
            }, 1000);
        }
        
        // 更新OTP
        function updateOTP() {
            if (currentTotp) {
                const token = currentTotp.generate();
                otpCode.textContent = token;
                
                // 添加动画效果
                otpCode.classList.add('scale-110');
                setTimeout(() => {
                    otpCode.classList.remove('scale-110');
                }, 300);
            }
        }
        
        // 添加到历史记录
        function addToHistory(secret) {
            // 检查是否已存在相同密钥
            const existingIndex = history.findIndex(item => item.secret === secret);
            
            if (existingIndex !== -1) {
                // 如果已存在，移到最前面
                const existing = history.splice(existingIndex, 1)[0];
                existing.timestamp = Date.now();
                history.unshift(existing);
            } else {
                // 限制历史记录数量为10条
                if (history.length >= 10) {
                    history.pop();
                }
                
                // 添加新记录
                history.unshift({
                    secret: secret,
                    timestamp: Date.now()
                });
            }
            
            // 保存到本地存储
            localStorage.setItem('2faHistory', JSON.stringify(history));
            
            // 更新UI
            renderHistory();
        }
        
        // 渲染历史记录
        function renderHistory() {
            if (history.length === 0) {
                noHistory.classList.remove('hidden');
                historyList.classList.add('hidden');
                return;
            }
            
            noHistory.classList.add('hidden');
            historyList.classList.remove('hidden');
            
            // 清空列表
            historyList.innerHTML = '';
            
            // 添加历史记录
            history.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'py-2 text-sm';
                
                // 格式化时间
                const date = new Date(item.timestamp);
                const timeString = date.toLocaleTimeString();
                
                li.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <span class="text-gray-800 font-medium truncate max-w-[180px]">${item.secret}</span>
                            <span class="text-gray-400 ml-2">${timeString}</span>
                        </div>
                        <button class="text-primary hover:text-primary/80 use-history" data-index="${index}">
                            <i class="fa fa-arrow-right"></i>
                        </button>
                    </div>
                `;
                
                historyList.appendChild(li);
            });
            
            // 添加使用历史记录事件
            document.querySelectorAll('.use-history').forEach(button => {
                button.addEventListener('click', () => {
                    const index = parseInt(button.getAttribute('data-index'));
                    const item = history[index];
                    
                    // 填充密钥
                    secretKeyInput.value = item.secret;
                    
                    // 生成OTP
                    generateOTP();
                    
                    // 滚动到顶部
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });
        }
        
        // 显示通知
        function showNotification(type, title, message) {
            // 设置通知类型
            if (type === 'success') {
                notificationIcon.className = 'flex-shrink-0 w-6 h-6 mr-3 flex items-center justify-center rounded-full bg-green-100';
                notificationIconI.className = 'fa fa-check text-green-500';
                notificationTitle.className = 'text-sm font-medium text-green-800';
            } else if (type === 'error') {
                notificationIcon.className = 'flex-shrink-0 w-6 h-6 mr-3 flex items-center justify-center rounded-full bg-red-100';
                notificationIconI.className = 'fa fa-times text-red-500';
                notificationTitle.className = 'text-sm font-medium text-red-800';
            } else if (type === 'warning') {
                notificationIcon.className = 'flex-shrink-0 w-6 h-6 mr-3 flex items-center justify-center rounded-full bg-yellow-100';
                notificationIconI.className = 'fa fa-exclamation text-yellow-500';
                notificationTitle.className = 'text-sm font-medium text-yellow-800';
            } else {
                notificationIcon.className = 'flex-shrink-0 w-6 h-6 mr-3 flex items-center justify-center rounded-full bg-blue-100';
                notificationIconI.className = 'fa fa-info text-blue-500';
                notificationTitle.className = 'text-sm font-medium text-blue-800';
            }
            
            // 设置通知内容
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // 显示通知
            notification.classList.remove('translate-y-full', 'opacity-0');
            
            // 3秒后自动隐藏
            setTimeout(hideNotification, 3000);
        }
        
        // 隐藏通知
        function hideNotification() {
            notification.classList.add('translate-y-full', 'opacity-0');
        }
        
        // 示例密钥点击事件
        document.querySelectorAll('.text-xs.text-gray-400.mt-2').forEach(element => {
            element.addEventListener('click', (e) => {
                if (e.target.tagName === 'SPAN') {
                    const secret = e.target.textContent;
                    secretKeyInput.value = secret;
                    generateOTP();
                }
            });
        });
    </script>
</body>
</html>
